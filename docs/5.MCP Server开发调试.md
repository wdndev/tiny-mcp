# 5.MCP Serverå¼€å‘è°ƒè¯•

> æ³¨æ„ï¼šå¦‚ä¸‹å®ç°åŸºäºPythonè¯­è¨€

## 1.åŸºäºLLMæ„å»ºMCP Server

åœ¨å®˜æ–¹æ–‡æ¡£ï¼ˆ[quickstart/server](https://modelcontextprotocol.io/quickstart/server "quickstart/server")ï¼‰ä¸­ï¼Œå¯ä»¥æ‰¾åˆ°`MCP Server`çš„å¼€å‘æ–¹å¼ï¼Œä»¥åŠå®˜æ–¹æä¾›çš„å„ä¸ªè¯­è¨€çš„ SDK çš„ç¤ºä¾‹ä»£ç ã€‚

å®˜æ–¹å»ºè®®é€šè¿‡`AI`æ¥å¸®æˆ‘ä»¬å®ç°`MCP`ï¼Œæ‰€ä»¥åœ¨æ–‡æ¡£ä¸­å•ç‹¬è¿˜æä¾›äº†ä¸€ä¸ª[Building MCP with LLMs](https://modelcontextprotocol.io/tutorials/building-mcp-with-llms "Building MCP with LLMs")çš„ç« èŠ‚ã€‚

Building MCP with LLMs å¤§è‡´æ€è·¯ï¼š

```markdown 
åœ¨å¼€å§‹ä¹‹å‰ï¼Œæ”¶é›†å¿…è¦çš„æ–‡æ¡£ï¼Œä»¥å¸®åŠ© AI äº†è§£ MCPï¼š

è®¿é—® https://modelcontextprotocol.io/llms-full.txt å¹¶å¤åˆ¶å®Œæ•´çš„æ–‡æ¡£æ–‡æœ¬ã€‚
å¯¼èˆªåˆ° MCP çš„ TypeScript è½¯ä»¶å¼€å‘å·¥å…·åŒ…ï¼ˆSDKï¼‰æˆ– Python è½¯ä»¶å¼€å‘å·¥å…·åŒ…çš„ä»£ç ä»“åº“ã€‚
å¤åˆ¶ï¼ˆREADMEï¼‰å’Œå…¶ä»–ç›¸å…³æ–‡æ¡£ã€‚
å°†è¿™äº›æ–‡æ¡£ç²˜è´´åˆ°ä½ ä¸å…‹åŠ³å¾·çš„å¯¹è¯ä¸­ã€‚
æä¾›äº†ç›¸å…³æ–‡æ¡£ä¹‹åï¼Œå‘ AI æ¸…æ™°åœ°æè¿°ä½ æƒ³è¦æ„å»ºçš„æœåŠ¡å™¨ç±»å‹ï¼š

ä½ çš„æœåŠ¡å™¨å°†å…¬å¼€å“ªäº›èµ„æºã€‚
å®ƒå°†æä¾›å“ªäº›å·¥å…·ã€‚
å®ƒåº”è¯¥ç»™å‡ºçš„ä»»ä½•æç¤ºã€‚
å®ƒéœ€è¦ä¸å“ªäº›å¤–éƒ¨ç³»ç»Ÿè¿›è¡Œäº¤äº’ã€‚
æ¯”å¦‚è¿™æ˜¯ä¸€ä¸ªä¾‹å­ï¼šæ„å»ºä¸€ä¸ª MCP æœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨ï¼š

è¿æ¥åˆ°æˆ‘å…¬å¸çš„ PostgreSQL æ•°æ®åº“ã€‚
å°†è¡¨æ¨¡å¼ä½œä¸ºèµ„æºå…¬å¼€ã€‚
æä¾›ç”¨äºè¿è¡Œåªè¯» SQL æŸ¥è¯¢çš„å·¥å…·ã€‚
åŒ…å«é’ˆå¯¹å¸¸è§æ•°æ®åˆ†æä»»åŠ¡çš„æç¤ºã€‚
```


åœ¨å®é™…æµ‹è¯•ä¸­å‘ç°ï¼Œä¸Šé¢æåˆ°çš„ [https://modelcontextprotocol.io/llms-full.txt](https://modelcontextprotocol.io/llms-full.txt "https://modelcontextprotocol.io/llms-full.txt") è¿™ä¸ªæ–‡æ¡£å°±æ˜¯æ•´ä¸ªæ–‡æ¡£ç«™çš„å†…å®¹ï¼Œé‡Œé¢åŒ…å«äº†å¾ˆå¤šæ„å»º MCP Server ä¸éœ€è¦çš„å†…å®¹ï¼Œåè€Œä¼šç»™æ¨¡å‹é€ æˆå¹²æ‰°ï¼Œå¤§å®¶å¯ä»¥ç›´æ¥å‚è€ƒä¸‹é¢çš„æç¤ºè¯ï¼š

```markdown 
## éœ€æ±‚

åŸºäºæä¾›çš„ MCP ç›¸å…³èµ„æ–™ï¼Œå¸®æˆ‘æ„å»ºä¸€ä¸ª MCP Serverï¼Œéœ€æ±‚å¦‚ä¸‹ï¼š

- æä¾›ä¸€ä¸ªè·å–å½“å‰æ—¶é—´çš„å·¥å…·
- æ¥æ”¶æ—¶åŒºä½œä¸ºå‚æ•°ï¼ˆå¯é€‰ï¼‰
- ç¼–å†™æ¸…æ™°çš„æ³¨é‡Šå’Œè¯´æ˜
- è¦æ±‚åŠŸèƒ½ç®€æ´ã€åªåŒ…å«å…³é”®åŠŸèƒ½
- ä½¿ç”¨ Python è¯­è¨€ç¼–å†™

è¯·å‚è€ƒä¸‹é¢å››ä¸ªèµ„æ–™ï¼š

## [å‚è€ƒèµ„æ–™ 1] MCP åŸºç¡€ä»‹ç»

- ç²˜è´´ https://modelcontextprotocol.io/introduction é‡Œçš„å†…å®¹ã€‚

## [å‚è€ƒèµ„æ–™ 2] MCP æ ¸å¿ƒæ¶æ„

- ç²˜è´´ https://modelcontextprotocol.io/docs/concepts/architecture é‡Œçš„å†…å®¹ã€‚

## [å‚è€ƒèµ„æ–™ 3] MCP Server å¼€å‘æŒ‡å¼•

- ç²˜è´´ https://modelcontextprotocol.io/quickstart/server é‡Œçš„å†…å®¹ã€‚

## [å‚è€ƒèµ„æ–™ 4] MCP Python SDK æ–‡æ¡£

- ç²˜è´´ https://github.com/modelcontextprotocol/python-sdk/blob/main/README.md é‡Œçš„å†…å®¹ã€‚
```


ä¸‹é¢æ˜¯ä¸€ä¸ª AI ç”Ÿæˆå¥½çš„ MCP Server çš„å…³é”®ä»£ç ï¼š

```python 
from datetime import datetime
from zoneinfo import ZoneInfo, ZoneInfoNotFoundError
from typing import Optional
from mcp.server.fastmcp import FastMCP

mcp = FastMCP("TimeServer")

@mcp.tool()
def get_current_time(timezone: Optional[str] = None) -> str:
    """
    è·å–æŒ‡å®šæ—¶åŒºæˆ–æœ¬åœ°çš„å½“å‰æ—¶é—´
    
    å‚æ•°ï¼š
        timezone (str, å¯é€‰): IANAæ ‡å‡†æ—¶åŒºåç§°ï¼ˆä¾‹å¦‚'Asia/Shanghai'ï¼‰
                            æ”¯æŒè‡ªåŠ¨æ¸…ç†è¾“å…¥çš„ç©ºæ ¼å’Œå¤§å°å†™è½¬æ¢
    
    è¿”å›ï¼š
        str: æ ¼å¼åŒ–çš„å½“å‰æ—¶é—´ï¼Œæ ¼å¼ä¸º'YYYY-MM-DD HH:MM:SS [æ—¶åŒºåç§°]'
            åŒ…å«æ›´å‹å¥½çš„é”™è¯¯æç¤º
    """
    try:
        # è¾“å…¥æ¸…ç†å’Œè§„èŒƒåŒ–
        if timezone:
            # å»é™¤å‰åç©ºæ ¼å¹¶æ›¿æ¢ä¸‹åˆ’çº¿ä¸ºæ–œæ ï¼ˆå¤„ç†å¸¸è§ç¬”è¯¯ï¼‰
            cleaned_tz = timezone.strip().replace("_", "/")
            tz = ZoneInfo(cleaned_tz)
        else:
            tz = datetime.now().astimezone().tzinfo
        
        current_time = datetime.now(tz)
        
        # æ·»åŠ æ—¶åŒºè¯¦ç»†ä¿¡æ¯
        tz_info = (
            f"{tz.tzname(current_time)} "
            f"(UTC{current_time.strftime('%z')})"
        )
        
        return current_time.strftime(f"%Y-%m-%d %H:%M:%S {tz_info}")
        
    except ZoneInfoNotFoundError as e:
        # æä¾›å¸¸è§æ—¶åŒºç¤ºä¾‹
        examples = "\n".join([
            "å¸¸è§æ—¶åŒºç¤ºä¾‹ï¼š",
            "- Europe/London", 
            "- Asia/Shanghai",
            "- UTC",
            "å®Œæ•´åˆ—è¡¨ï¼šhttps://en.wikipedia.org/wiki/List_of_tz_database_time_zones"
        ])
        return f"æ— æ•ˆæ—¶åŒºåç§°ï¼š'{timezone}'\n{examples}"
    except Exception as e:
        return f"æ—¶é—´æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•ï¼ˆé”™è¯¯ä»£ç ï¼š{hash(e) & 0xFFFF})"

if __name__ == "__main__":
    mcp.run(transport='stdio')
```


ä»£ç ä¸»è¦æœ‰ä¸‰éƒ¨åˆ†ç»„æˆï¼š

1. ä½¿ç”¨`FastMCP`åŒ…ï¼Œåˆ›å»ºä¸€ä¸ª`mcp` å®ä¾‹ï¼›
2. ä½¿ç”¨`@mcp.tool`å®šä¹‰æä¾›çš„å·¥å…·æ–¹æ³•ï¼ŒåŒ…æ‹¬å·¥å…·æ–¹æ³•çš„åç§°ã€å·¥å…·æ–¹æ³•çš„æè¿°ã€å·¥å…·æ–¹æ³•çš„å‚æ•°ã€å·¥å…·æ–¹æ³•çš„å…·ä½“å®ç°é€»è¾‘ã€‚
3. å¯åŠ¨ Serverï¼Œå¹¶ä¸”ä½¿ç”¨`transport`æ¥å®šä¹‰å·¥å…·ä½¿ç”¨`STDIO`é€šä¿¡åè®®ï¼Œç­‰å¾…å¤–éƒ¨çš„æ ‡å‡†è¾“å…¥ï¼Œå¹¶ä¸”æŠŠå·¥å…·çš„æ‰§è¡Œç»“æœè½¬åŒ–ä¸ºæ ‡å‡†è¾“å‡ºåé¦ˆåˆ°å¤–éƒ¨ã€‚

åªéœ€è¦æŒ‰ç…§è¿™ä¸ªæ¨¡æ¿æ¥æ·»åŠ æ›´å¤šçš„å·¥å…·å®ç°å°±å¯ä»¥äº†ï¼Œå¦å¤– Resourcesã€Prompt çš„ç¼–å†™æ–¹å¼å…¶å®éƒ½æ˜¯ç±»ä¼¼çš„ï¼Œå¤§å®¶åªéœ€è¦æŒ‰ç…§è¿™å¥—æç¤ºè¯æ¨¡æ¿ï¼Œå®šä¹‰å¥½è‡ªå·±çš„éœ€æ±‚ï¼ŒAIï¼ˆClaude çš„å‡†ç¡®æ€§æœ€é«˜ï¼‰åŸºæœ¬ä¸Šéƒ½èƒ½æ¯”è¾ƒå®Œæ•´çš„å®ç°ã€‚

## 2.è°ƒè¯•MCP Server

å¼€å‘å®Œæˆåï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨å®˜æ–¹æä¾›çš„`MCP Server`è°ƒè¯•å·¥å…·ï¼ˆ`mcp dev`ï¼‰æ¥è¿›è¡Œè°ƒè¯•ã€‚

åœ¨ç»ˆç«¯ä¸­è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œè°ƒè¯•åˆšåˆšå¼€å‘å®Œæˆçš„MCP Serverï¼š

```bash 
mcp dev services/time_service.py
```


å¯åŠ¨æ—¥å¿—ï¼š

```bash 
(tiny-mcp) PS tiny-mcp> mcp dev E:/04Code/llm/mcp_code/services/time_service.py
Starting MCP inspector...
âš™ï¸ Proxy server listening on port 6277
ğŸ” MCP Inspector is up and running at http://127.0.0.1:6274 ğŸš€
```


å¯åŠ¨æˆåŠŸåï¼Œå®ƒä¼šåœ¨æˆ‘ä»¬çš„æœ¬åœ°ç›‘å¬ 6274 ç«¯å£ï¼Œæˆ‘ä»¬ç‚¹å‡»`Connect`ï¼š

![](image/image_EU3yBuGc1K.png)

è¿æ¥æˆåŠŸåï¼Œæˆ‘ä»¬ç‚¹å‡»`List Tools`ï¼š

![](image/image_9lw_yPif3q.png)

ç„¶åå¯ä»¥çœ‹åˆ°å½“å‰`MCP Server`å®šä¹‰çš„æ‰€æœ‰å·¥å…·ï¼Œè¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªè·å–å½“å‰æ—¶é—´çš„å·¥å…·ï¼Œç‚¹å‡»è¿™ä¸ªå·¥å…·ï¼Œå¯ä»¥å¯¹å®ƒè¿›è¡Œè°ƒè¯•ï¼š

![](image/image_zih1b1ycD8.png)

å¯ä»¥åœ¨ä¸‹æ–¹æ‰€æœ‰äº¤äº’äº§ç”Ÿçš„è¯·æ±‚å’Œå“åº”çš„å…·ä½“æ•°æ®ï¼š

![](image/image_oNUH9CKU8s.png)

åŸºäºè¿™æ ·çš„æ€è·¯ï¼Œå¯ä»¥ä½¿ç”¨`mcp dev`è°ƒè¯•ä»»æ„çš„`MCP Server`ï¼Œ åœ¨ä½ æƒ³è¦ä½¿ç”¨ï¼Œä½†æ˜¯è¿˜ä¸çŸ¥é“æ€ä¹ˆä½¿ç”¨ä¸€ä¸ª`MCP Server`æ—¶ï¼Œéƒ½å¯ä»¥ä½¿ç”¨å®ƒè¿›è¡Œè°ƒè¯•

## 3.æµ‹è¯•MCP Server

### 3.1 Cherry Studio

åœ¨ Cherry Studioä¸­å¦‚ä¸‹é…ç½®ï¼Œé›†åˆä½¿ç”¨ï¼š

![](image/image_rVLj3A3P-z.png)

æµ‹è¯•è¿è¡Œï¼š

![](image/image_3fn0yYsAnR.png)

### 3.2 Cline

é…ç½®`MCP Server`ï¼š

```json 
{
  "mcpServers": {
    "get_current_time": {
      "name": "æ—¶é—´",
      "type": "stdio",
      "description": "è·å–æ—¶é—´",
      "isActive": true,
      "registryUrl": "",
      "command": "uv",
      "args": [
        "--directory",
        "E:/04Code/llm/mcp_code/tiny-mcp-demo/services",
        "run",
        "time_service.py"
      ]
    }
  }
}
```


è¿è¡Œç»“æœï¼š

![](image/image_WRDMnpVt2G.png)



